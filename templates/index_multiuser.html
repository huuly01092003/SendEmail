<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover" />
    <title>C√¥ng C·ª• T√°ch File & G·ª≠i Email T·ª± ƒê·ªông</title>
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Manrope:wght@400;500;600;700&display=swap" rel="stylesheet">

    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    
    <script src="{{ url_for('static', filename='js/app.js') }}" defer></script>
</head>

<body>
    
    <div class="background-animation"></div>

    <div id="loading-overlay" class="loading-overlay">
        <div class="spinner"></div>
        <p id="loading-text">ƒêang x·ª≠ l√Ω...</p>
    </div>

    <div class="theme-switcher">
        <button data-theme="light" title="Ch·∫ø ƒë·ªô S√°ng">‚òÄÔ∏è</button>
        <button data-theme="dark" title="Ch·∫ø ƒë·ªô T·ªëi">üåô</button>
        <button data-theme="aurora" title="Ch·∫ø ƒë·ªô Aurora">üåå</button>
    </div>

    <div class="page-container">

        <header class="navbar card-glass">
            <h1>üß© C√¥ng C·ª• T√°ch File & G·ª≠i Email T·ª± ƒê·ªông</h1>
            <div class="user-info">
                {% if user_email %}
                    <span class="user-email" title="{{ user_email }}">üë§ {{ user_email }}</span>
                    <a href="/auth/logout" class="btn btn-danger">ƒêƒÉng Xu·∫•t</a>
                {% else %}
                    <span class="user-email">üë§ Kh√°ch</span>
                {% endif %}
            </div>
        </header>

        {% if not user_email %}
        <main>
            <section class="card-glass auth-prompt">
                <div class="alert alert-warning text-center">
                    <h2 class="card-title">üîê Vui l√≤ng ƒêƒÉng Nh·∫≠p</h2>
                    <p></p>
                    <a href="/auth/login" class="btn btn-primary btn-lg">
                        üîì ƒêƒÉng Nh·∫≠p V·ªõi Gmail
                    </a>
                </div>
            </section>
        </main>
        {% endif %}

        <main class="main-grid">

            <section class="card-glass" id="split-card">
                <h2 class="card-title">üßæ 1. T√°ch File Excel</h2>
                <form action="/split" method="post" enctype="multipart/form-data" class="form-layout" id="splitForm">
                    <div class="alert alert-info">
                        T√°ch file Excel g·ªëc th√†nh file ZIP ch·ª©a c√°c file nh·ªè theo c·ªôt ƒë·ªãnh danh.
                    </div>

                    <div class="form-group file-group">
                        <label for="split-file">üìÇ File Excel g·ªëc (.xlsx, .xls)</label>
                        <input type="file" name="file" id="split-file" accept=".xlsx,.xls" required />
                        <span class="file-name">Ch∆∞a ch·ªçn file...</span>
                    </div>

                    <div class="form-group floating-label">
                        <input type="text" id="split-column" name="column_name" placeholder=" " required />
                        <label for="split-column">üß± T√™n c·ªôt c·∫ßn chia (VD: M√£ ƒê·ªëi T√°c)</label>
                    </div>

                    <div class="grid grid-cols-3 gap-4">
                        <div class="form-group floating-label">
                            <input type="number" id="template-end-row" name="template_end_row" placeholder=" " required />
                            <label for="template-end-row">üìÑTemplate</label>
                        </div>
                        <div class="form-group floating-label">
                            <input type="number" id="data-start-row" name="start_row" placeholder=" " required />
                            <label for="data-start-row">üìä D√≤ng ƒë·∫ßu</label>
                        </div>
                        <div class="form-group floating-label">
                            <input type="number" id="data-end-row" name="end_row" placeholder=" " required />
                            <label for="data-end-row">üìà D√≤ng cu·ªëi</label>
                        </div>
                    </div>

                    <button type="submit" class="btn btn-secondary w-full">‚¨áÔ∏è T√°ch File v√† T·∫£i ZIP</button>
                </form>
            </section>
            
            <section class="card-glass" id="email-card" {% if not user_email %}style="display:none;"{% endif %}>
                <h2 class="card-title">‚úâÔ∏è 2. G·ª≠i Email B√°o C√°o</h2>
                
                <form id="emailForm" class="form-layout">
                    
                    <fieldset class="form-fieldset">
                        <legend>üë§ Th√¥ng Tin Ng∆∞·ªùi G·ª≠i</legend>
                        <div class="alert alert-info">
                            <b>‚ÑπÔ∏è Email g·ª≠i:</b> {{ user_email }}
                        </div>
                        <div class="form-group floating-label">
                            <input type="text" id="sender-name" name="sender_name" placeholder=" " required />
                            <label for="sender-name">T√™n ng∆∞·ªùi g·ª≠i (VD: C√¥ng ty ABC)</label>
                        </div>
                    </fieldset>

                    <fieldset class="form-fieldset">
                        <legend>üì¶ D·ªØ Li·ªáu G·ª≠i Mail</legend>
                        <div class="grid grid-cols-2 gap-4">
                            <div class="form-group file-group">
                                <label for="split-zip">File ZIP ƒë√£ t√°ch:</label>
                                <input type="file" name="split_zip" id="split-zip" accept=".zip" required />
                                <span class="file-name">Ch∆∞a ch·ªçn file...</span>
                            </div>
                            <div class="form-group file-group">
                                <label for="email-file">File DS Email:</label>
                                <input type="file" name="email_file" id="email-file" accept=".xlsx,.xls" required />
                                <span class="file-name">Ch∆∞a ch·ªçn file...</span>
                            </div>
                        </div>

                        <div class="grid grid-cols-3 gap-4">
                            <div class="form-group floating-label">
                                <input type="text" id="ref-col" name="ref_col" placeholder=" " required />
                                <label for="ref-col">C·ªôt ID ch√≠nh</label>
                            </div>
                            <div class="form-group floating-label">
                                <input type="text" id="name-col" name="name_col" placeholder=" " />
                                <label for="name-col">C·ªôt T√™n ID</label>
                            </div>
                            <div class="form-group floating-label">
                                <input type="text" id="email-col" name="email_col" placeholder=" " required />
                                <label for="email-col">C·ªôt Email ch√≠nh</label>
                            </div>
                        </div>
                        
                        <div class="grid grid-cols-3 gap-4">
                            <div class="form-group floating-label">
                                <input type="text" id="cc-col" name="cc_col" placeholder=" " />
                                <label for="cc-col">C·ªôt Email CC</label>
                            </div>
                            <div class="form-group floating-label">
                                <input type="number" id="email-start-row" name="start_row_email" placeholder=" " required />
                                <label for="email-start-row">D√≤ng b·∫Øt ƒë·∫ßu</label>
                            </div>
                            <div class="form-group floating-label">
                                <input type="number" id="email-end-row" name="end_row_email" placeholder=" " required />
                                <label for="email-end-row">D√≤ng k·∫øt th√∫c</label>
                            </div>
                        </div>
                    </fieldset>

                    <fieldset class="form-fieldset">
                        <legend>üìù M·∫´u Email</legend>
                        <div class="form-group floating-label">
                            <input type="text" id="subject" name="subject" value="B√°o c√°o - {ten_npp}" placeholder=" " required />
                            <label for="subject">Ti√™u ƒë·ªÅ</label>
                        </div>
                        <div class="form-group floating-label">
                            <textarea id="body" name="body" rows="5" placeholder=" " required>K√≠nh g·ª≠i {ten_npp},

Xin g·ª≠i b√°o c√°o th√°ng n√†y k√®m theo.

Tr√¢n tr·ªçng!</textarea>
                            <label for="body">N·ªôi dung</label>
                        </div>
                    </fieldset>

                    <button type="submit" id="submitBtn" class="btn btn-primary w-full btn-lg">üöÄ G·ª≠i Email T·ª± ƒê·ªông</button>
                </form>

                <div id="progressSection" class="progress-section" style="display: none;">
                    <h3 class="progress-title">üìä Ti·∫øn ƒë·ªô g·ª≠i email</h3>
                    <div class="progress-bar">
                        <div id="progressFill" class="progress-fill" style="width: 0%">0%</div>
                    </div>
                    <p id="progressText" class="progress-text">ƒêang chu·∫©n b·ªã...</p>
                    <button id="downloadBtn" class="btn btn-secondary w-full" style="display:none;">üì• T·∫£i File Log CSV</button>
                </div>
            </section>
            
        </main>

        <footer class="footer">
            ¬© 2025 Modern UI Refactor. All rights reserved.
        </footer>
    </div>
</body>
</html>