<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>C√¥ng C·ª• T√°ch File & G·ª≠i Email</title>
          <!-- Favicon chu·∫©n -->
    <link rel="icon" type="image/png" sizes="32x32" href="{{ url_for('static', filename='images/favicon-32x32.png') }}">
    <link rel="icon" type="image/png" sizes="16x16" href="{{ url_for('static', filename='images/favicon-16x16.png') }}">
    <link rel="shortcut icon" href="{{ url_for('static', filename='images/favicon.ico') }}">

    <!-- D√†nh cho iOS -->
    <link rel="apple-touch-icon" sizes="180x180" href="{{ url_for('static', filename='images/apple-touch-icon.png') }}">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Manrope:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    <script src="{{ url_for('static', filename='js/app.js') }}" defer></script>
</head>

<body>
    <div class="background-animation"></div>

    <div id="loading-overlay" class="loading-overlay">
        <div class="spinner"></div>
        <p id="loading-text">ƒêang x·ª≠ l√Ω...</p>
    </div>

    <div class="theme-switcher">
        <button data-theme="light" title="Ch·∫ø ƒë·ªô S√°ng">‚òÄÔ∏è</button>
        <button data-theme="dark" title="Ch·∫ø ƒë·ªô T·ªëi">üåô</button>
        <button data-theme="aurora" title="Ch·∫ø ƒë·ªô Aurora">üåå</button>
    </div>

    <div class="page-container">

        <header class="navbar card-glass">
            <h1>üß© C√¥ng C·ª• T√°ch File & G·ª≠i Email T·ª± ƒê·ªông</h1>
            <div class="user-info">
                {% if user_email %}
                    <span class="user-email">üë§ {{ user_email }}</span>
                    <a href="/auth/logout" class="btn btn-danger">ƒêƒÉng Xu·∫•t</a>
                {% else %}
                    <a href="/auth/login" class="btn btn-primary">üîê ƒêƒÉng Nh·∫≠p Gmail</a>
                {% endif %}
            </div>
        </header>

        <main class="main-grid">

            <section class="card-glass">
                <h2 class="card-title">üßæ 1. T√°ch File Excel</h2>
                <form action="/split" method="post" enctype="multipart/form-data" class="form-layout" id="splitForm">
                    <div class="alert alert-info">
                        üìã T√°ch file Excel theo c·ªôt ƒë·ªãnh danh.
                    </div>

                    <div class="form-group file-group">
                        <label for="split-file">üìÇ File Excel g·ªëc</label>
                        <input type="file" name="file" id="split-file" accept=".xlsx,.xls" required />
                        <span class="file-name">Ch∆∞a ch·ªçn file...</span>
                    </div>

                    <div class="form-group" id="sheet-group" style="display: none;">
                        <label for="sheet-select">üìÑ Sheet c·∫ßn t√°ch</label>
                        <select id="sheet-select" name="sheet_name" style="width: 100%; padding: 10px 12px; font-size: 1rem; background: var(--input-bg); color: var(--text-color); border: 1px solid var(--input-border); border-radius: 8px; font-family: var(--font-main);" required>
                            <option value="">-- Ch·ªçn Sheet --</option>
                        </select>
                    </div>

                    <div class="grid grid-cols-3 gap-4">
                        <div class="form-group floating-label">
                            <input type="number" id="template-end-row" name="template_end_row" min="1" placeholder=" " required />
                            <label for="template-end-row">üìãTemplatec</label>
                        </div>
                        <div class="form-group floating-label">
                            <input type="number" id="data-start-row" name="start_row" min="1" placeholder=" " required />
                            <label for="data-start-row">üìä D√≤ng ƒë·∫ßu</label>
                        </div>
                        <div class="form-group floating-label">
                            <input type="number" id="data-end-row" name="end_row" min="1" placeholder=" " required />
                            <label for="data-end-row">üìà D√≤ng cu·ªëi</label>
                        </div>
                    </div>

                    <div class="grid grid-cols-3 gap-4">
                        <div class="form-group floating-label">
                            <input type="text" id="start-col" name="start_col" placeholder=" " />
                            <label for="start-col">C·ªôt ƒë·∫ßu (A, B)</label>
                        </div>
                        <div class="form-group floating-label">
                            <input type="text" id="end-col" name="end_col" placeholder=" " />
                            <label for="end-col">C·ªôt cu·ªëi</label>
                        </div>
                        <div class="form-group floating-label">
                            <input type="text" id="split-column" name="split_column" placeholder=" " required />
                            <label for="split-column">C·ªôt c·∫ßn chia</label>
                        </div>
                    </div>

                    <fieldset class="form-fieldset">
                        <legend>üìù T√™n c·ªôt ID (Tu·ª≥ Ch·ªçn)</legend>
                        <div class="alert alert-info">
                            <b>‚ÑπÔ∏è Nh·∫≠p t√™n c·ªôt ƒë·ªÉ t·∫°o t√™n file:</b> <code>M√É-T√äN.xlsx</code>
                        </div>
                        <div class="form-group floating-label">
                            <input type="text" id="name-column" name="name_col" placeholder=" " />
                            <label for="name-column">T√™n c·ªôt d√πng cho t√™n file</label>
                        </div>
                    </fieldset>

                    <button type="submit" class="btn btn-secondary w-full btn-lg">‚¨áÔ∏è T√°ch File & T·∫£i ZIP</button>
                </form>
            </section>

            <section class="card-glass" id="email-section">
                <h2 class="card-title">‚úâÔ∏è 2. G·ª≠i Email B√°o C√°o</h2>
                
                <form id="emailForm" class="form-layout">
                    <fieldset class="form-fieldset">
                        <legend>üë§ Th√¥ng Tin Ng∆∞·ªùi G·ª≠i</legend>
                        <div class="alert alert-info"> <b>‚úÖ Email g·ª≠i:</b> <span id="sender-email">{% if user_email %}{{ user_email }}{% else %}Ch∆∞a ƒëƒÉng nh·∫≠p{% endif %}</span></div>
                        <div class="form-group floating-label">
                            <input type="text" id="sender-name" name="sender_name" value="C√¥ng ty" placeholder=" " required />
                            <label for="sender-name">T√™n ng∆∞·ªùi g·ª≠i</label>
                        </div>
                    </fieldset>

                    <fieldset class="form-fieldset">
                        <legend>üì¶ Upload Folder File Excel</legend>
                        <div class="form-group file-group">
                            <label for="excel-files">üìÇ Ch·ªçn file .xlsx</label>
                            <input type="file" name="files" id="excel-files" accept=".xlsx" multiple required />
                            <span class="file-name">0 file ƒë∆∞·ª£c ch·ªçn</span>
                        </div>
                        <div id="file-count" class="alert alert-info" style="display:none;">
                            üìä ƒê√£ ch·ªçn: <strong id="count-text">0</strong> file
                        </div>
                    </fieldset>

                    <fieldset class="form-fieldset">
                        <legend>üìß File Danh S√°ch Email</legend>
                        <div class="form-group file-group">
                            <label for="email-file">File Excel ch·ª©a danh s√°ch email</label>
                            <input type="file" name="email_file" id="email-file" accept=".xlsx,.xls" required />
                            <span class="file-name">Ch∆∞a ch·ªçn file...</span>
                        </div>
                    </fieldset>

                    <fieldset class="form-fieldset">
                        <legend>üîó C·∫•u H√¨nh C·ªôt</legend>
                        <div class="grid grid-cols-3 gap-4">
                            <div class="form-group floating-label">
                                <input type="text" id="ref-col" name="ref_col" placeholder=" " required />
                                <label for="ref-col">C·ªôt M√£ ID ch√≠nh</label>
                            </div>
                            <div class="form-group floating-label">
                                <input type="text" id="name-col" name="name_col" placeholder=" " />
                                <label for="name-col">C·ªôt T√™n</label>
                            </div>
                            <div class="form-group floating-label">
                                <input type="text" id="email-col" name="email_col" placeholder=" " required />
                                <label for="email-col">C·ªôt Email ch√≠nh</label>
                            </div>
                        </div>
                        
                        <div class="grid grid-cols-3 gap-4">
                            <div class="form-group floating-label">
                                <input type="text" id="cc-col" name="cc_col" placeholder=" " />
                                <label for="cc-col">C·ªôt Email CC</label>
                            </div>
                            <div class="form-group floating-label">
                                <input type="number" id="email-start-row" name="start_row_email"  min="1" placeholder=" " required />
                                <label for="email-start-row">D√≤ng email b·∫Øt ƒë·∫ßu</label>
                            </div>
                            <div class="form-group floating-label">
                                <input type="number" id="email-end-row" name="end_row_email" min="1" placeholder=" " required />
                                <label for="email-end-row">D√≤ng email k·∫øt th√∫c</label>
                            </div>
                        </div>
                    </fieldset>

                    <fieldset class="form-fieldset">
                        <legend>üìù M·∫´u Email</legend>
                        <div class="form-group floating-label">
                            <input type="text" id="subject" name="subject" value="B√°o c√°o - {ten_npp}" placeholder=" " required />
                            <label for="subject">Ti√™u ƒë·ªÅ</label>
                        </div>
                        <div class="form-group floating-label">
                            <textarea id="body" name="body" rows="5" placeholder=" " required>K√≠nh g·ª≠i {ten_npp},

Xin g·ª≠i b√°o c√°o th√°ng n√†y k√®m theo.

Tr√¢n tr·ªçng!</textarea>
                            <label for="body">N·ªôi dung</label>
                        </div>
                        <div class="alert alert-info">
                            <b>üî§ Bi·∫øn c√≥ s·∫µn:</b> {ma_npp} (M√£), {ten_npp} (T√™n)
                        </div>
                    </fieldset>

                    <button type="submit" id="submitBtn" class="btn btn-primary w-full btn-lg">üöÄ G·ª≠i Email T·ª± ƒê·ªông</button>
                </form>

                <div id="progressSection" class="progress-section" style="display: none;">
                    <h3 class="progress-title">üìä Ti·∫øn ƒë·ªô g·ª≠i email</h3>
                    <div class="progress-bar">
                        <div id="progressFill" class="progress-fill" style="width: 0%">0%</div>
                    </div>
                    <p id="progressText" class="progress-text">ƒêang chu·∫©n b·ªã...</p>
                    <button id="downloadBtn" class="btn btn-secondary w-full" style="display:none;">üì• T·∫£i File Log CSV</button>
                </div>
            </section>
            
        </main>

        <footer class="footer">
            ¬© 2025 Gmail OAuth Tool. Built with ‚ù§Ô∏è
        </footer>
    </div>

    <style>
        #sheet-select:focus {
            outline: none;
            border-color: var(--primary);
        }
    </style>
</body>
</html>